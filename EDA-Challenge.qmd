---
title: "Exercise 03: Explore and Wrangle Data"
format: html
execute:
  echo: true
  warning: false
  message: false
---

## Setup

tidyverse library for data import and wrangling.

```{r}
library(tidyverse)
```

## Loading the dataset and inspecting variables

From the provided URL we can first load the data set into the object called "d".

```{r}
f<- "https://raw.githubusercontent.com/difiore/ada-datasets/main/data-wrangling.csv"
d<- read_csv(f, col_names = TRUE)

```

We can take a quick look at the data we loaded and variables in it.

```{r}
head(d)
dim(d)
str(d)

# Get the class of each column
sapply(d, class)


#Listing variable names

names(d)
```

## Step 1

#### Creating new variables

#### **1) BSD** (body size dimorphism) - Ratio of average male to female body mass.

#### **2) sex_ratio** - Ratio of the number of adult females to adult males in a typical group.

#### **3) DI** (for “defensibility index”) - Ratio of day range length to the diameter of the home range.

```{r}
#BSD (body size dimorphism) - Ratio of average male to female body mass

d$BSD<-d$Body_mass_male_mean/d$Body_mass_female_mean
d$BSD

#sex_ratio - Ratio of the number of adult females to adult males in a typical group

d$sex_ratio<-d$AdultFemale/d$AdultMales
d$sex_ratio


```

We need a calculation here, to get the diameter of the home range to be derived from HomeRange_km2 in order to get the new variable "DI-defensibility index"

```{r}
d$HomeRange_diameter <- 2 * sqrt(d$HomeRange_km2 / pi)
d$HomeRange_diameter

#DI (for “defensibility index”) - Ratio of day range length to the diameter of the home range

d$DI <- d$DayLength_km/d$HomeRange_diameter
d$DI
```

Since a division is included we must make sure that the rows where the relavant denominator is zero the new variable is INF. To check this,

```{r}
which(is.infinite(d$BSD)) # Checking whether denominator zeros have given any INF
which(is.infinite(d$sex_ratio))
which(is.infinite(d$DI))
```

There is no any instances as INF.

#### 4) Relationship between day range length and time spent moving

First trying out **ggplot2** to visualize this relationship.

The reason for choosing **ggplot2** for this plot is we can use faceting by family to generate one plot per family. So our comparison will be easy.Using a scatterplot because both are continuous variables,

Explaining the layers and inside parameters used : aesthetics layer - Mapping given variables to x and y axis, to customize the plot..geometry layer - 0.5 opacity points, color=black, size=4 and a smooth line to show where all points are lying generally. Using labs() to set the x- and y-axis labels.

```{r}
library(ggplot2)

# Overall plot (all species)

ggplot(d, aes(x = Move, y = DayLength_km)) +
  geom_point(alpha=0.5,color="black",size=4, na.rm = TRUE) + geom_smooth(method = lm)+labs(x="Tiem spent moving", y="Day range length")
```

Should we use log values to plot? How to decide??

Since the values seems to be more towards a corner , let's use log values to plot

```{r}
# Overall plot (all species)

ggplot(d, aes(x =log(Move), y = log(DayLength_km))) +
  geom_point(alpha=0.5,color="black",size=4, na.rm = TRUE) + geom_smooth(method = lm)+labs(x="Tiem spent moving", y="Day range length")

```

#### By family comparison

1\) Approach 1: First using the color aesthetic inside geom_point() to show different families.Defining it inside the geometry layer does not affect other layers.

```{r}
library(ggplot2)

# plot all species in one plotwith dfferent color for each

ggplot(d, aes(x = log(Move), y = log(DayLength_km))) +
  geom_point(alpha=0.5, aes(color=Family),na.rm = TRUE)+geom_smooth(method=lm)+labs(x="Tiem spent moving", y="Day range length")
```

2\) Approach 2- Now, we are using facet_wrap() layer in ggplot2 to visualize families in a separate plot

```{r}
ggplot(d, aes(x = Move, y = DayLength_km)) +
  geom_point(aes(color = Family), na.rm = TRUE)  +
  facet_wrap(~ Family)+labs(
    x = "Time spent moving",
    y = "Day range length (km)"
  )+labs(x="Tiem spent moving", y="Day range length")
```

Do species that spend more time moving travel farther overall? How about within any particular primate family?

Should you transform either of these variables? Why or why not?

Should we use log values to plot? How to decide??

Since the values seems to be more towards a corner , let's use log values to plot

#### 5) relationship between day range length and group size 

```{r}
# Overall plot (all species)
ggplot(d, aes(x = MeanGroupSize, y = DayLength_km)) +
  geom_point(na.rm = TRUE) +
  geom_smooth(method = "lm", se = FALSE, na.rm = TRUE)
```

```{r}
ggplot(d, aes(x = MeanGroupSize, y = DayLength_km)) +
  geom_point(aes(color = Family),na.rm = TRUE)  +
  facet_wrap(~ Family)
```

Do species that live in larger groups travel farther, overall, in a day? How about within any particular primate family? Should you transform either of these variables?

#### 6) relationship between canine size dimorphism (y axis) and body size dimorphism (x axis)

```{r}
# Overall plot (all species)
ggplot(d, aes(x = BSD, y = Canine_Dimorphism)) +
  geom_point(na.rm = TRUE) +
  geom_smooth(method = "lm", se = FALSE, na.rm = TRUE)
```

```{r}
ggplot(d, aes(x = BSD, y = Canine_Dimorphism)) +
  geom_point(aes(color = Family),na.rm = TRUE)  +
  facet_wrap(~ Family)
```

Do taxa with greater size dimorphism also show greater canine dimorphism?

#### 7) Create a new variable named **diet_strategy** that is “frugivore” if fruits make up \>50% of the diet, “folivore” if leaves make up \>50% of the diet, and “omnivore” if diet data are available but neither of these is true (i.e., these values are not `NA`). Then, create boxplots of group size for species with different dietary strategies, omitting the category `NA` from your plot. Do frugivores live in larger groups than folivores?

```{r}
# Creating a new variable named "diet_strategy"



d1<-mutate(d, diet_strategy = ifelse(Fruit >= 50, "frugivore", ifelse(Leaves >= 50, "folivore",
    ifelse(Fruit < 50 & Leaves < 50 & !is.na(Fruit) & !is.na(Leaves), "omnivore", NA))))



d1$diet_strategy
```

```{r}


# we need to remove the rows from the dataset where the diet_strategy is N/A for this
# Using subsetting

d2 <- d1[!is.na(d1$diet_strategy), ]

d2

```

```{r}
# Creating boxplots of group size for species with different dietary strategies
# diet_strategy should be the x axis.


ggplot(data = d2, aes(x = diet_strategy, y = MeanGroupSize))+ 
  geom_boxplot(na.rm = TRUE) + 
  theme(axis.text.x = element_text(angle = 90))+ 
  labs(x= "diet_strategy", y="Group Size (MeanGroupSize)")



```

Do frugivores live in larger groups than folivores?
