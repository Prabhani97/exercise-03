---
title: "Exercise 03: Explore and Wrangle Data"
format: html
execute:
  echo: true
  warning: false
  message: false
---

#### Setup

We can use tidyverse library for data import and wrangling.

```{r}
library(tidyverse)
```

#### Loading the dataset and inspecting variables

From the provided URL we can first load the data set into the object called "d".

```{r}
f<- "https://raw.githubusercontent.com/difiore/ada-datasets/main/data-wrangling.csv"
d<- read_csv(f, col_names = TRUE)

```

We can take a quick look at the data we loaded and variables in it.

```{r}
head(d)
tail(d)
dim(d)
str(d)


#Listing variable names

names(d)
```

#### Step 1

#### Creating new variables

#### **1) BSD (body size dimorphism) - Ratio of average male to female body mass.**

#### **2) sex_ratio - Ratio of the number of adult females to adult males in a typical group.**

#### **3) DI (for “defensibility index”) - Ratio of day range length to the diameter of the home range.**

```{r}
#BSD (body size dimorphism) - Ratio of average male to female body mass

d$BSD<-d$Body_mass_male_mean/d$Body_mass_female_mean
d$BSD

#sex_ratio - Ratio of the number of adult females to adult males in a typical group

d$sex_ratio<-d$AdultFemale/d$AdultMales
d$sex_ratio


```

We need a calculation here, to get the diameter of the home range to be derived from HomeRange_km2 in order to get the new variable "DI (defensibility index)"

```{r}
d$HomeRange_diameter <- 2 * sqrt(d$HomeRange_km2 / pi)
d$HomeRange_diameter

#DI (for “defensibility index”) - Ratio of day range length to the diameter of the home range

d$DI <- d$DayLength_km/d$HomeRange_diameter
d$DI
```

Since a division is included we must make sure that the rows where the relavant denominator is zero the new variable is INF. To check this,

```{r}
which(is.infinite(d$BSD)) # Checking whether denominator zeros have given any INF
which(is.infinite(d$sex_ratio))
which(is.infinite(d$DI))
```

There is no any instances as INF. So there are no divisions by zero and the numerator N/A values will produce a N/A value for new variable as well naturally.

#### 4) Plotting the relationship between day range length and time spent moving

First trying out ggplot2 to visualize this relationship.

The reason for choosing ggplot2 for this plot is we can use faceting by family to generate one plot per family. So our comparison between families would be easy.Using a scatterplot because both are continuous variables,

**Explaining the layers and parameters used :**

1\) Aesthetics layer - Mapping given variables to X (Time spent moving) and Y (Day range length) axis,

2\) Geometry layers - To customize the plot, defining alpha= 0.5 (opacity of the points), color=black, size=4 , na.rm =TRUE to drop rows with missing values for the plotted variables. Opasity is set at 0.5 to see overlapping points.

3\) geom_smooth() to show where the trend of all points are lying generally.

3\) Using labs() to set the X- and Y-axis labels.

```{r}
library(ggplot2)

# Overall plot (representing all species)

p<-ggplot(d, aes(x = Move, y = DayLength_km))
p<-p+ geom_point(alpha=0.5,color="black",size=4, na.rm = TRUE)
p<-p+ geom_smooth(method = "lm", se = FALSE, na.em=TRUE)
p<-p+labs(x="Time spent moving", y="Day range length")
p
```

**Should we transform values?**

The above plotted values seems to be skewed to a certain direction of the plot. Therefore, we can use log values of the variables for the plot. If we convert the values to log values, the minus(-) values for day range length variable will indicate the values between 0 and 1.

```{r}
# Overall plot (representing all species) - Now using log() values

d<-d[ is.finite(log(d$Move)) & is.finite(log(d$DayLength_km)), ] # Removing invalid values after log convrersion
p<-ggplot(d, aes(x = log(Move), y = log(DayLength_km)))
p<-p+ geom_point(alpha=0.5,color="black",size=4, na.rm = TRUE)
p<-p+ geom_smooth(method = lm, se = FALSE,na.em=TRUE)
p<-p+labs(x="log(Time spent moving)", y="log(Day range length)")
p
```

#### By family comparison

1\) **Approach 1**: First using the aesthetic mapping inside geom_point() to show different families.Defining it inside the geometry layer does not affect other layers.

```{r}

# Plotting all species in one plot with dfferent color for each

d<-d[ is.finite(log(d$Move)) & is.finite(log(d$DayLength_km)), ] # Removing invalid values after log convrersion
p<-ggplot(d, aes(x = log(Move), y = log(DayLength_km)))
p<-p+ geom_point(alpha=0.5,aes(color=Family),size=4, na.rm = TRUE)
p<-p+ geom_smooth(method = lm, se = FALSE,na.em=TRUE)
p<-p+labs(x="log(Time spent moving)", y="log(Day range length)")
p
```

2\) **Approach 2**- Now, we are using facet_wrap() layer in ggplot2 to visualize families in a separate plot

```{r}
# Using a separate plot t represent one family

d<-d[ is.finite(log(d$Move)) & is.finite(log(d$DayLength_km)), ] # Removing invalid values after log convrersion
p<-ggplot(d, aes(x = log(Move), y = log(DayLength_km)))
p<-p+ geom_point(alpha=0.5,aes(color=factor(Family)),size=2, na.rm = TRUE)
p<-p+ geom_smooth(method = lm, se = FALSE,na.em=TRUE)
p<-p+ facet_wrap(~ Family)
p<-p+labs(x="log(Time spent moving)", y="log(Day range length)")
p
```

This approach is good for identifying patterns separate for each family.

**Do species that spend more time moving travel farther overall? How about within any particular primate family?**

-   Looking at above plots, we can say that the relationship between x and y variables are not very strong. But, considering overall the slope of the line upwards tell us that species spend more time moving likely to have longer day range lengths.

-   Above overall conclusion varies slightly if we consider families separately. Atelidae family show a considerable good positive relationship, from which we can tell that the species spend more time moving generally travel farther within a day.

-   Cebidae and Hylobatidae also show a positive trend, but we cannot say exactly it is a positive relationship because they have very small sample sizes. similar observation with Indriidae.

-   Cercopithecidae and and Lemuridae shows a flat relationship while only Hominidae shows a negative relationship which tells us that the time they spent moving is less allocated to move farther away or the time they spent moving is not necessarily for travelling farther away respectively.

#### 5) Plotting the relationship between day range length and group size

Applying same considerations applied for above plot. We can transform these variables into log values to avoid the skewness of data points in the plot and to get a clear wide spread visualization.

```{r}
# Overall plot (all species)

d<-d[ is.finite(log(d$MeanGroupSize)) & is.finite(log(d$DayLength_km)), ] # Removing invalid values after log convrersion
p<-ggplot(d, aes(x = log(MeanGroupSize), y = log(DayLength_km)))
p<-p+ geom_point(alpha=0.5,color="black",size=4, na.rm = TRUE)
p<-p+ geom_smooth(method = lm, se = FALSE,na.em=TRUE)
p<-p+labs(x="log(Mean Group Size)", y="log(Day range length)")
p
```

```{r}

# Using a separate plot t represent one family

d<-d[ is.finite(log(d$MeanGroupSize)) & is.finite(log(d$DayLength_km)), ] # Removing invalid values after log convrersion
p<-ggplot(d, aes(x = log(MeanGroupSize), y = log(DayLength_km)))
p<-p+ geom_point(alpha=0.5,aes(color=factor(Family)),size=2, na.rm = TRUE)
p<-p+ geom_smooth(method = lm, se = FALSE,na.em=TRUE)
p<-p+ facet_wrap(~ Family)
p<-p+labs(x="log(Mean Group Size)", y="log(Day range length)")
p

unique(d$Family)
unique(d$Species)
```

**Do species that live in larger groups travel farther, overall, in a day? How about within any particular primate family?**

-   Overall there is a positive relationship between group size and day range length. This tells us that who is living in larger groups tend to travel farther per day.

-   When looking at the relationship within individual primate families, the pattern is not so consistant.

-   Cercopithecidae show a clear positive relationship telling us that species with larger group sizes tend to have longer day ranges even within the family.

-   Atelidae and Hominidae also shows a positive trend, but these have very few data points. Therefore, hard to exactly predict this.

-   Lemuridae show a weak and nearly flat relationship, indicating little change in day range length with increasing group size.

-   Hylobatidae and Indriidae again have very limited data points, making it difficult to infer any reliable within-family relationship.

#### 6) Plotting the relationship between canine size dimorphism (y axis) and body size dimorphism (x axis)

```{r}
# Overall plot (all species)

d<-d[ is.finite(log(d$BSD)) & is.finite(log(d$Canine_Dimorphism)), ] # Removing invalid values after log convrersion
p<-ggplot(d, aes(x = log(BSD), y = log(Canine_Dimorphism)))
p<-p+ geom_point(alpha=0.5,color="black",size=4, na.rm = TRUE)
p<-p+ geom_smooth(method = lm, se = FALSE,na.em=TRUE)
p<-p+labs(x="log(body size dimorphism)", y="log(canine size dimorphism)")
p
```

```{r}
# Using a separate plot t represent one family

d<-d[ is.finite(log(d$ BSD)) & is.finite(log(d$Canine_Dimorphism)), ] # Removing invalid values after log convrersion
p<-ggplot(d, aes(x = log(BSD), y = log(Canine_Dimorphism)))
p<-p+ geom_point(alpha=0.5,aes(color=factor(Family)),size=2, na.rm = TRUE)
p<-p+ geom_smooth(method = lm, se = FALSE,na.em=TRUE)
p<-p+ facet_wrap(~ Family)
p<-p+labs(x="log(BSD)", y="log(Canine_Dimorphism)")
p

unique(d$Family)
unique(d$Species)
```

**Do taxa with greater size dimorphism also show greater canine dimorphism?**

-   Overall, we can see a positive relationship between body size dimorphism and canine dimorphism because the trending line's slope is upward.

-   if we consider species within primate families, Cercopithecidae show a clear positive trend which tells us that species with higher body size dimorphism also tend to have higher canine dimorphism.

-   Hominidae show a weak positive trend, also Atelidae and Lemuridae show little to no clear relationship within the family.

-   One common limitations to above data visualizations is there are limited data points for some families which makes it harder to interpret a relationship between two variables accurately.

#### 7) Creating a new variable named **diet_strategy** 

( “frugivore” if fruits make up \>50% of the diet, “folivore” if leaves make up \>50% of the diet, and “omnivore” if diet data are available but neither of these is true (i.e., these values are not `NA`))

```{r}
# Creating a new variable named "diet_strategy"
# Using mutate function to add the new column

d1<-mutate(d, diet_strategy = ifelse(Fruit >= 50, "frugivore", ifelse(Leaves >= 50, "folivore",
    ifelse(Fruit < 50 & Leaves < 50 & !is.na(Fruit) & !is.na(Leaves), "omnivore", NA))))

# viewing the created column
d1$diet_strategy
```

```{r}

# we need to remove the rows from the dataset where the diet_strategy is N/A for this
# Using subsetting

d2 <- d1[!is.na(d1$diet_strategy), ]

d2

```

#### Creating boxplots of group size for species with different dietary strategies, omitting the category `NA`

```{r}
# Creating boxplots of group size for species with different dietary strategies
# diet_strategy should be the x axis.

p<- ggplot(data = d2, aes(x = diet_strategy, y = MeanGroupSize))
p<- p+ geom_boxplot(na.rm = TRUE)
p<-p+ theme(axis.text.x = element_text(angle = 90)) 
p<-p+ labs(x= "diet_strategy", y="Group Size (MeanGroupSize)")
p

```

**Do frugivores live in larger groups than folivores?**

Looking at the median lines of the boxplots of two categories, folivores have a slightly higher median line. This tells us that on average, folivore species live in somewhat larger groups than frugivores. But, the plot also tells us that frugivores have some very large group sized species as well because of the strong upper outliers. The largest group size of folivores are not that high as frugivores. We can also tell that the variability of group sizes in frugivores us higher then folivores too looking at the boxes.

**Question 8**

1\) using mutate() to add a variable, Binomial to the data frame d, which is a concatenation of the Genus and Species variables

2\) Using select() to trim the data frame to only include the variables Binomial, Family, Brain_size_species_mean, and Body_mass_male_mean

3\) Using group_by() to group above variables by Family

4\) Using summarise() to calculate the average value for Brain_Size_Species_Mean and Body_mass_male_mean per Family

5\) using arrange() to arrange by *increasing* average brain size

```{r}
d1<-d %>%
  mutate(Binomial = paste(Genus, Species)) %>%
  select(Binomial, Family, Brain_Size_Species_Mean, Body_mass_male_mean) %>%
  group_by(Family) %>%
  summarise(
    mean_brain = mean(Brain_Size_Species_Mean, na.rm = TRUE),
    mean_body  = mean(Body_mass_male_mean, na.rm = TRUE)
  ) %>%
  arrange(mean_brain)
d1
```
